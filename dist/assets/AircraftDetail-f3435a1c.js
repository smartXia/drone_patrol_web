import{_ as Se,I as Me,C as Te,J as xe,r as k,m as De,x as Ce,K as F,L as ke,b as M,o as z,c as R,f as a,w as n,e as t,u as S,M as Oe,g as w,t as d,s as q,N as Ne,O as je,P as Fe,Q as Be,R as $e,p as Ie,S as Le,q as Je,n as ze}from"./index-9ddbed48.js";const Re={class:"aircraft-detail"},Pe={class:"header-left"},Qe={class:"header-right"},Ve={key:0,class:"data-update-info"},qe={key:0,class:"connection-warning"},Ae={key:1,class:"loading-state"},He={key:2,class:"data-container"},Ue={class:"card-header"},Ee={class:"info-content"},Ge={class:"info-item"},Ke={class:"value"},We={class:"info-item"},Xe={class:"value"},Ye={class:"info-item"},Ze={class:"value"},et={class:"info-item"},tt={class:"value"},st={class:"card-header"},at={class:"info-content"},nt={class:"info-item"},ot={class:"info-item"},lt={class:"info-item"},it={class:"card-header"},dt={class:"info-content"},rt={class:"info-item"},ct={class:"value"},ut={class:"info-item"},_t={class:"value"},pt={class:"info-item"},vt={class:"value"},ft={class:"info-item"},gt={class:"value"},mt={class:"card-header"},yt={class:"info-content"},ht={class:"info-item"},bt={class:"info-item"},wt={class:"info-item"},St={class:"value"},Mt={class:"card-header"},Tt={class:"info-content"},xt={class:"info-item"},Dt={class:"info-item"},Ct={class:"info-item"},kt={class:"info-item"},Ot={class:"card-header"},Nt={class:"info-content"},jt={class:"info-item"},Ft={class:"value"},Bt={class:"info-item"},$t={class:"value"},It={class:"info-item"},Lt={class:"card-header"},Jt={class:"info-content"},zt={class:"info-item"},Rt={class:"value"},Pt={class:"info-item"},Qt={class:"info-item"},Vt={class:"card-header"},qt={class:"json-viewer"},At=["innerHTML"],Ht={__name:"AircraftDetail",setup(Ut){const Y=Me(),Z=Te(),x=xe(),P=k(""),o=k(null),O=k(!1),B=k(!1),j=k(null),$=k(null),I=k(null);k(0);const L=De(()=>`thing/product/${P.value}/osd`);Ce(()=>{P.value=Y.params.deviceSn||"",P.value?E():(F.error("未找到设备SN参数"),G())}),ke(()=>{te(),I.value&&clearTimeout(I.value),L.value&&x.unsubscribeTopics(L.value)});const E=async()=>{if(!x.isConnected){F.warning("MQTT未连接，无法订阅OSD数据");return}try{await x.subscribeToTopics(L.value,1),F.success(`已订阅OSD主题: ${L.value}`),ee()}catch(s){console.error("订阅OSD主题失败:",s),F.error("订阅OSD主题失败")}},ee=()=>{j.value&&clearInterval(j.value),j.value=setInterval(()=>{se()},2e3)},te=()=>{j.value&&(clearInterval(j.value),j.value=null)},se=()=>{const s=x.messageHistory.filter(e=>e.topic===L.value);if(s.length>0){const e=s[0];if(e.id!==$.value)try{const r=JSON.parse(e.payload);ae(r)?!o.value||ne(o.value,r)?(I.value&&clearTimeout(I.value),I.value=setTimeout(()=>{o.value=r,O.value=!0,$.value=e.id,console.log("OSD数据已更新:",new Date().toLocaleTimeString(),"消息ID:",e.id),console.log("OSD数据内容:",r)},200)):($.value=e.id,console.log("OSD数据无变化，跳过更新")):(console.warn("收到无效的OSD数据，跳过更新:",r),$.value=e.id)}catch(r){console.error("解析OSD数据失败:",r,"原始数据:",e.payload),$.value=e.id}}else o.value&&O.value&&(console.log("暂无新OSD消息，保持现有数据显示"),O.value||(O.value=!0))},ae=s=>!s||typeof s!="object"?!1:s.data&&typeof s.data=="object"?Object.keys(s.data).length>0:["latitude","longitude","height","drone_charge_state","battery","altitude","speed"].some(c=>c in s),ne=(s,e)=>{var Q,V;if(!s||!e)return!0;const r=s.timestamp||0,c=e.timestamp||0;if(r!==c)return!0;const A=["latitude","longitude","height","drone_charge_state","environment_temperature"];for(const T of A)if(((Q=s.data)==null?void 0:Q[T])!==((V=e.data)==null?void 0:V[T]))return!0;return!1},G=()=>{Z.go(-1)},K=s=>{if(!s)return"--";const e=["B","KB","MB","GB","TB"];let r=s,c=0;for(;r>=1024&&c<e.length-1;)r/=1024,c++;return`${r.toFixed(2)} ${e[c]}`},W=s=>!s||!s.total?0:Math.round(s.used/s.total*100),oe=s=>{const e=W(s);return e>90?"#f56c6c":e>70?"#e6a23c":"#67c23a"},le=s=>s>50?"#67c23a":s>20?"#e6a23c":"#f56c6c",ie=s=>({0:"success",1:"warning",2:"danger"})[s]||"info",de=s=>({0:"正常",1:"充电中",2:"异常"})[s]||"未知",re=s=>({0:"success",1:"warning",2:"info"})[s]||"info",ce=s=>({0:"正常模式",1:"存储模式",2:"其他模式"})[s]||"未知",ue=s=>({0:"info",1:"success",2:"primary",3:"warning"})[s]||"info",_e=s=>({0:"未知",1:"WiFi",2:"4G",3:"其他"})[s]||"未知",pe=s=>s>=4?"#67c23a":s>=2?"#e6a23c":"#f56c6c",ve=s=>({0:"未知",1:"低",2:"中",3:"高",4:"最高"})[s]||"未知",fe=s=>({0:"success",1:"warning",2:"danger"})[s]||"info",ge=s=>({0:"正常",1:"警告",2:"错误"})[s]||"未知",me=s=>{try{let e;if(typeof s=="string"){const r=JSON.parse(s);e=JSON.stringify(r,null,2)}else if(typeof s=="object"&&s!==null)e=JSON.stringify(s,null,2);else return String(s);return e.replace(/(".*?")\s*:/g,'<span class="json-key">$1</span>:').replace(/:\s*(".*?")/g,': <span class="json-string">$1</span>').replace(/:\s*(\d+)/g,': <span class="json-number">$1</span>').replace(/:\s*(true|false)/g,': <span class="json-boolean">$1</span>').replace(/:\s*(null)/g,': <span class="json-null">$1</span>').replace(/([{}[\]])/g,'<span class="json-bracket">$1</span>').replace(/(,)/g,'<span class="json-comma">$1</span>')}catch{return String(s)}},ye=s=>s?new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"--",he=async()=>{if(o.value)try{const s=JSON.stringify(o.value,null,2);await navigator.clipboard.writeText(s),B.value=!0,setTimeout(()=>{B.value=!1},2e3),F.success("OSD数据已复制到剪贴板")}catch(s){console.error("复制失败:",s),F.error("复制失败，请手动复制")}};return(s,e)=>{const r=M("el-button"),c=M("el-tag"),A=M("el-header"),Q=M("el-alert"),V=M("el-empty"),T=M("el-icon"),D=M("el-card"),N=M("el-col"),H=M("el-progress"),U=M("el-row"),be=M("el-main"),we=M("el-container");return z(),R("div",Re,[a(we,{style:{height:"100vh"}},{default:n(()=>[a(A,{class:"detail-header"},{default:n(()=>[t("div",Pe,[a(r,{type:"primary",icon:S(Oe),onClick:G,style:{"margin-right":"16px"}},{default:n(()=>[...e[0]||(e[0]=[w(" 返回 ",-1)])]),_:1},8,["icon"]),t("h2",null,"飞机信息详情 - "+d(P.value),1)]),t("div",Qe,[O.value&&o.value?(z(),R("div",Ve,[a(c,{type:"info",size:"small",style:{"margin-right":"8px"}},{default:n(()=>[w(" 最后更新: "+d(ye(o.value.timestamp)),1)]),_:1})])):q("",!0),a(c,{type:S(x).isConnected?"success":"danger",size:"large"},{default:n(()=>[w(d(S(x).isConnected?"已连接":"未连接"),1)]),_:1},8,["type"])])]),_:1}),a(be,{class:"detail-main"},{default:n(()=>[S(x).isConnected?q("",!0):(z(),R("div",qe,[a(Q,{title:"MQTT未连接",description:"请先在仪表板页面连接MQTT服务器以获取实时数据",type:"warning","show-icon":"",closable:!1})])),S(x).isConnected&&!O.value?(z(),R("div",Ae,[a(V,{description:"等待OSD数据..."},{default:n(()=>[a(r,{type:"primary",onClick:E},{default:n(()=>[...e[1]||(e[1]=[w(" 手动订阅OSD主题 ",-1)])]),_:1})]),_:1})])):q("",!0),O.value?(z(),R("div",He,[a(U,{gutter:20,class:"data-grid"},{default:n(()=>[a(N,{span:8},{default:n(()=>[a(D,{class:"info-card",shadow:"hover"},{header:n(()=>[t("div",Ue,[a(T,null,{default:n(()=>[a(S(Ne))]),_:1}),e[2]||(e[2]=t("span",null,"位置信息",-1))])]),default:n(()=>{var u,_,p,v,f,g,m,y,i,l,b,h;return[t("div",Ee,[t("div",Ge,[e[3]||(e[3]=t("span",{class:"label"},"纬度:",-1)),t("span",Ke,d(((p=(_=(u=o.value)==null?void 0:u.data)==null?void 0:_.latitude)==null?void 0:p.toFixed(6))||"--"),1)]),t("div",We,[e[4]||(e[4]=t("span",{class:"label"},"经度:",-1)),t("span",Xe,d(((g=(f=(v=o.value)==null?void 0:v.data)==null?void 0:f.longitude)==null?void 0:g.toFixed(6))||"--"),1)]),t("div",Ye,[e[5]||(e[5]=t("span",{class:"label"},"高度:",-1)),t("span",Ze,d(((i=(y=(m=o.value)==null?void 0:m.data)==null?void 0:y.height)==null?void 0:i.toFixed(2))||"--")+"m",1)]),t("div",et,[e[6]||(e[6]=t("span",{class:"label"},"航向:",-1)),t("span",tt,d(((h=(b=(l=o.value)==null?void 0:l.data)==null?void 0:b.heading)==null?void 0:h.toFixed(1))||"--")+"°",1)])])]}),_:1})]),_:1}),a(N,{span:8},{default:n(()=>[a(D,{class:"info-card",shadow:"hover"},{header:n(()=>[t("div",st,[a(T,null,{default:n(()=>[a(S(je))]),_:1}),e[7]||(e[7]=t("span",null,"电池状态",-1))])]),default:n(()=>{var u,_,p,v,f,g,m,y,i,l,b;return[t("div",at,[t("div",nt,[e[8]||(e[8]=t("span",{class:"label"},"电量:",-1)),a(H,{percentage:((p=(_=(u=o.value)==null?void 0:u.data)==null?void 0:_.drone_charge_state)==null?void 0:p.capacity_percent)||0,color:le((g=(f=(v=o.value)==null?void 0:v.data)==null?void 0:f.drone_charge_state)==null?void 0:g.capacity_percent),"show-text":!0},null,8,["percentage","color"])]),t("div",ot,[e[9]||(e[9]=t("span",{class:"label"},"充电状态:",-1)),a(c,{type:ie((i=(y=(m=o.value)==null?void 0:m.data)==null?void 0:y.drone_charge_state)==null?void 0:i.state)},{default:n(()=>{var h,C,J;return[w(d(de((J=(C=(h=o.value)==null?void 0:h.data)==null?void 0:C.drone_charge_state)==null?void 0:J.state)),1)]}),_:1},8,["type"])]),t("div",lt,[e[10]||(e[10]=t("span",{class:"label"},"存储模式:",-1)),a(c,{type:re((b=(l=o.value)==null?void 0:l.data)==null?void 0:b.battery_store_mode)},{default:n(()=>{var h,C;return[w(d(ce((C=(h=o.value)==null?void 0:h.data)==null?void 0:C.battery_store_mode)),1)]}),_:1},8,["type"])])])]}),_:1})]),_:1}),a(N,{span:8},{default:n(()=>[a(D,{class:"info-card",shadow:"hover"},{header:n(()=>[t("div",it,[a(T,null,{default:n(()=>[a(S(Fe))]),_:1}),e[11]||(e[11]=t("span",null,"环境信息",-1))])]),default:n(()=>{var u,_,p,v,f,g,m,y,i,l;return[t("div",dt,[t("div",rt,[e[12]||(e[12]=t("span",{class:"label"},"环境温度:",-1)),t("span",ct,d(((p=(_=(u=o.value)==null?void 0:u.data)==null?void 0:_.environment_temperature)==null?void 0:p.toFixed(1))||"--")+"°C",1)]),t("div",ut,[e[13]||(e[13]=t("span",{class:"label"},"设备温度:",-1)),t("span",_t,d(((g=(f=(v=o.value)==null?void 0:v.data)==null?void 0:f.temperature)==null?void 0:g.toFixed(1))||"--")+"°C",1)]),t("div",pt,[e[14]||(e[14]=t("span",{class:"label"},"湿度:",-1)),t("span",vt,d(((y=(m=o.value)==null?void 0:m.data)==null?void 0:y.humidity)||"--")+"%",1)]),t("div",ft,[e[15]||(e[15]=t("span",{class:"label"},"风速:",-1)),t("span",gt,d(((l=(i=o.value)==null?void 0:i.data)==null?void 0:l.wind_speed)||"--")+"m/s",1)])])]}),_:1})]),_:1})]),_:1}),a(U,{gutter:20,class:"data-grid",style:{"margin-top":"20px"}},{default:n(()=>[a(N,{span:12},{default:n(()=>[a(D,{class:"info-card",shadow:"hover"},{header:n(()=>[t("div",mt,[a(T,null,{default:n(()=>[a(S(Be))]),_:1}),e[16]||(e[16]=t("span",null,"网络状态",-1))])]),default:n(()=>{var u,_,p,v,f,g,m,y,i,l,b,h;return[t("div",yt,[t("div",ht,[e[17]||(e[17]=t("span",{class:"label"},"网络类型:",-1)),a(c,{type:ue((p=(_=(u=o.value)==null?void 0:u.data)==null?void 0:_.network_state)==null?void 0:p.type)},{default:n(()=>{var C,J,X;return[w(d(_e((X=(J=(C=o.value)==null?void 0:C.data)==null?void 0:J.network_state)==null?void 0:X.type)),1)]}),_:1},8,["type"])]),t("div",bt,[e[18]||(e[18]=t("span",{class:"label"},"信号质量:",-1)),a(H,{percentage:(((g=(f=(v=o.value)==null?void 0:v.data)==null?void 0:f.network_state)==null?void 0:g.quality)||0)*20,color:pe((i=(y=(m=o.value)==null?void 0:m.data)==null?void 0:y.network_state)==null?void 0:i.quality),"show-text":!0},null,8,["percentage","color"])]),t("div",wt,[e[19]||(e[19]=t("span",{class:"label"},"传输速率:",-1)),t("span",St,d(ve((h=(b=(l=o.value)==null?void 0:l.data)==null?void 0:b.network_state)==null?void 0:h.rate)),1)])])]}),_:1})]),_:1}),a(N,{span:12},{default:n(()=>[a(D,{class:"info-card",shadow:"hover"},{header:n(()=>[t("div",Mt,[a(T,null,{default:n(()=>[a(S($e))]),_:1}),e[20]||(e[20]=t("span",null,"设备状态",-1))])]),default:n(()=>{var u,_,p,v,f,g,m,y;return[t("div",Tt,[t("div",xt,[e[21]||(e[21]=t("span",{class:"label"},"模式代码:",-1)),a(c,{type:fe((_=(u=o.value)==null?void 0:u.data)==null?void 0:_.mode_code)},{default:n(()=>{var i,l;return[w(d(ge((l=(i=o.value)==null?void 0:i.data)==null?void 0:l.mode_code)),1)]}),_:1},8,["type"])]),t("div",Dt,[e[22]||(e[22]=t("span",{class:"label"},"在机库:",-1)),a(c,{type:(v=(p=o.value)==null?void 0:p.data)!=null&&v.drone_in_dock?"success":"info"},{default:n(()=>{var i,l;return[w(d((l=(i=o.value)==null?void 0:i.data)!=null&&l.drone_in_dock?"是":"否"),1)]}),_:1},8,["type"])]),t("div",Ct,[e[23]||(e[23]=t("span",{class:"label"},"静默模式:",-1)),a(c,{type:(g=(f=o.value)==null?void 0:f.data)!=null&&g.silent_mode?"warning":"success"},{default:n(()=>{var i,l;return[w(d((l=(i=o.value)==null?void 0:i.data)!=null&&l.silent_mode?"开启":"关闭"),1)]}),_:1},8,["type"])]),t("div",kt,[e[24]||(e[24]=t("span",{class:"label"},"紧急停止:",-1)),a(c,{type:(y=(m=o.value)==null?void 0:m.data)!=null&&y.emergency_stop_state?"danger":"success"},{default:n(()=>{var i,l;return[w(d((l=(i=o.value)==null?void 0:i.data)!=null&&l.emergency_stop_state?"激活":"正常"),1)]}),_:1},8,["type"])])])]}),_:1})]),_:1})]),_:1}),a(U,{gutter:20,class:"data-grid",style:{"margin-top":"20px"}},{default:n(()=>[a(N,{span:12},{default:n(()=>[a(D,{class:"info-card",shadow:"hover"},{header:n(()=>[t("div",Ot,[a(T,null,{default:n(()=>[a(S(Ie))]),_:1}),e[25]||(e[25]=t("span",null,"存储信息",-1))])]),default:n(()=>{var u,_,p,v,f,g,m,y,i,l;return[t("div",Nt,[t("div",jt,[e[26]||(e[26]=t("span",{class:"label"},"总容量:",-1)),t("span",Ft,d(K((p=(_=(u=o.value)==null?void 0:u.data)==null?void 0:_.storage)==null?void 0:p.total)),1)]),t("div",Bt,[e[27]||(e[27]=t("span",{class:"label"},"已使用:",-1)),t("span",$t,d(K((g=(f=(v=o.value)==null?void 0:v.data)==null?void 0:f.storage)==null?void 0:g.used)),1)]),t("div",It,[e[28]||(e[28]=t("span",{class:"label"},"使用率:",-1)),a(H,{percentage:W((y=(m=o.value)==null?void 0:m.data)==null?void 0:y.storage),color:oe((l=(i=o.value)==null?void 0:i.data)==null?void 0:l.storage),"show-text":!0},null,8,["percentage","color"])])])]}),_:1})]),_:1}),a(N,{span:12},{default:n(()=>[a(D,{class:"info-card",shadow:"hover"},{header:n(()=>[t("div",Lt,[a(T,null,{default:n(()=>[a(S(Le))]),_:1}),e[29]||(e[29]=t("span",null,"子设备信息",-1))])]),default:n(()=>{var u,_,p,v,f,g,m,y,i;return[t("div",Jt,[t("div",zt,[e[30]||(e[30]=t("span",{class:"label"},"设备SN:",-1)),t("span",Rt,d(((p=(_=(u=o.value)==null?void 0:u.data)==null?void 0:_.sub_device)==null?void 0:p.device_sn)||"--"),1)]),t("div",Pt,[e[31]||(e[31]=t("span",{class:"label"},"在线状态:",-1)),a(c,{type:(g=(f=(v=o.value)==null?void 0:v.data)==null?void 0:f.sub_device)!=null&&g.device_online_status?"success":"danger"},{default:n(()=>{var l,b,h;return[w(d((h=(b=(l=o.value)==null?void 0:l.data)==null?void 0:b.sub_device)!=null&&h.device_online_status?"在线":"离线"),1)]}),_:1},8,["type"])]),t("div",Qt,[e[32]||(e[32]=t("span",{class:"label"},"配对状态:",-1)),a(c,{type:(i=(y=(m=o.value)==null?void 0:m.data)==null?void 0:y.sub_device)!=null&&i.device_paired?"success":"warning"},{default:n(()=>{var l,b,h;return[w(d((h=(b=(l=o.value)==null?void 0:l.data)==null?void 0:b.sub_device)!=null&&h.device_paired?"已配对":"未配对"),1)]}),_:1},8,["type"])])])]}),_:1})]),_:1})]),_:1}),a(D,{class:"raw-data-card",shadow:"hover",style:{"margin-top":"20px"}},{header:n(()=>[t("div",Vt,[a(T,null,{default:n(()=>[a(S(Je))]),_:1}),e[33]||(e[33]=t("span",null,"原始OSD数据",-1)),a(r,{type:"primary",size:"small",onClick:he,icon:B.value?"Check":"CopyDocument",class:ze({"copy-success":B.value}),style:{"margin-left":"auto"}},{default:n(()=>[w(d(B.value?"已复制":"复制"),1)]),_:1},8,["icon","class"])])]),default:n(()=>[t("div",qt,[t("pre",{class:"json-content",innerHTML:me(o.value)},null,8,At)])]),_:1})])):q("",!0)]),_:1})]),_:1})])}}},Gt=Se(Ht,[["__scopeId","data-v-adb88349"]]);export{Gt as default};
