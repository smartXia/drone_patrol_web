import{_ as se,r as c,k as oe,m as me,x as ne,L as pe,b as i,o as V,c as F,f as e,w as l,e as s,u as p,U as G,g as _,t as h,i as ee,V as le,W as te,X as _e,s as W,n as re,Y as ve,Q as fe,S as ge,Z as ye,$ as we,a0 as be,K as y,C as Se,M as Ve,a1 as he,F as xe,h as Ce,j as ae,a2 as $e,a3 as ke,E as Ue}from"./index-468fb462.js";const Fe={class:"camera-live-stream"},Pe={class:"card-header"},Te={class:"header-left"},ze={class:"header-right"},De={key:0,class:"camera-config"},Le={key:0,class:"video-placeholder"},Ee={key:1,class:"video-wrapper"},Re=["src"],Ie={key:0,class:"video-overlay"},Me={class:"video-info"},Be={class:"stream-info"},qe={class:"info-item"},Ne={class:"info-item"},Oe={key:0,class:"info-item"},je={class:"video-controls"},Je={class:"screenshot-preview"},We=["src"],He={__name:"CameraLiveStream",setup(ue){const m=c(null),b=c(!1),x=c(!1),C=c(!1),L=c(!1),P=c(!1),R=c(0),S=c("未连接"),E=c(!1),I=c(""),n=oe({url:"rtsp://192.168.1.100:554/stream1",username:"",password:"",resolution:"1280x720",fps:25,quality:7}),d=me(()=>{if(!n.url)return"";let r=n.url;if(n.username&&n.password){const a=r.split("://")[0],v=r.split("://")[1];r=`${a}://${n.username}:${n.password}@${v}`}return r});let M=null;const H=async()=>{if(!n.url){y.warning("请输入摄像头地址");return}x.value=!0,S.value="连接中...";try{await new Promise(r=>setTimeout(r,1e3)),m.value&&(m.value.src=d.value,m.value.load(),await new Promise((r,a)=>{const v=setTimeout(()=>{a(new Error("连接超时"))},1e4);m.value.onloadeddata=()=>{clearTimeout(v),r()},m.value.onerror=()=>{clearTimeout(v),a(new Error("视频加载失败"))}})),b.value=!0,x.value=!1,S.value="已连接",R.value=0,o(),y.success("摄像头连接成功")}catch(r){x.value=!1,S.value="连接失败",y.error(`连接失败: ${r.message}`)}},q=()=>{m.value&&(m.value.pause(),m.value.src=""),b.value=!1,S.value="未连接",R.value=0,t(),y.info("已停止直播")},A=()=>{C.value=!C.value},K=()=>{m.value&&(m.value.muted=!m.value.muted,L.value=m.value.muted)},Q=()=>{if(!m.value||!b.value){y.warning("请先开始直播");return}try{const r=document.createElement("canvas"),a=r.getContext("2d");r.width=m.value.videoWidth,r.height=m.value.videoHeight,a.drawImage(m.value,0,0),I.value=r.toDataURL("image/png"),E.value=!0,y.success("截图成功")}catch(r){y.error(`截图失败: ${r.message}`)}},N=()=>{if(I.value){const r=document.createElement("a");r.download=`camera-screenshot-${new Date().getTime()}.png`,r.href=I.value,r.click()}},X=()=>{P.value=!P.value,y.info(P.value?"开始录制":"停止录制")},o=()=>{M=setInterval(()=>{R.value++},1e3)},t=()=>{M&&(clearInterval(M),M=null)},z=r=>{const a=Math.floor(r/3600),v=Math.floor(r%3600/60),B=r%60;return a>0?`${a.toString().padStart(2,"0")}:${v.toString().padStart(2,"0")}:${B.toString().padStart(2,"0")}`:`${v.toString().padStart(2,"0")}:${B.toString().padStart(2,"0")}`},$=()=>{S.value="加载中..."},Y=()=>{S.value="已连接"},D=r=>{console.error("视频播放错误:",r),S.value="播放错误",y.error("视频播放失败，请检查摄像头配置")},O=()=>{S.value="播放中"},Z=()=>{S.value="已暂停"};return ne(()=>{const r=localStorage.getItem("camera-config");if(r)try{Object.assign(n,JSON.parse(r))}catch(a){console.error("加载摄像头配置失败:",a)}}),pe(()=>{q(),t()}),(r,a)=>{const v=i("el-icon"),B=i("el-tag"),w=i("el-button"),k=i("el-input"),f=i("el-form-item"),T=i("el-col"),j=i("el-row"),U=i("el-option"),u=i("el-select"),J=i("el-slider"),ie=i("el-form"),de=i("el-dialog"),ce=i("el-card");return V(),F("div",Fe,[e(ce,{shadow:"hover",class:"camera-card"},{header:l(()=>[s("div",Pe,[s("div",Te,[e(v,{class:"camera-icon"},{default:l(()=>[e(p(G))]),_:1}),a[9]||(a[9]=s("span",null,"机场直播摄像头",-1)),e(B,{type:b.value?"success":"info",size:"small",class:"status-tag"},{default:l(()=>[_(h(b.value?"直播中":"未连接"),1)]),_:1},8,["type"])]),s("div",ze,[b.value?(V(),ee(w,{key:1,type:"danger",size:"small",onClick:q,icon:p(te)},{default:l(()=>[...a[11]||(a[11]=[_(" 停止直播 ",-1)])]),_:1},8,["icon"])):(V(),ee(w,{key:0,type:"primary",size:"small",onClick:H,loading:x.value,icon:p(le)},{default:l(()=>[...a[10]||(a[10]=[_(" 开始直播 ",-1)])]),_:1},8,["loading","icon"])),e(w,{size:"small",onClick:A,icon:p(_e)},{default:l(()=>[...a[12]||(a[12]=[_(" 全屏 ",-1)])]),_:1},8,["icon"])])])]),default:l(()=>[b.value?W("",!0):(V(),F("div",De,[e(ie,{model:n,"label-width":"100px",size:"small"},{default:l(()=>[e(j,{gutter:16},{default:l(()=>[e(T,{span:12},{default:l(()=>[e(f,{label:"摄像头地址"},{default:l(()=>[e(k,{modelValue:n.url,"onUpdate:modelValue":a[0]||(a[0]=g=>n.url=g),placeholder:"rtsp://ip:port/stream",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(T,{span:6},{default:l(()=>[e(f,{label:"用户名"},{default:l(()=>[e(k,{modelValue:n.username,"onUpdate:modelValue":a[1]||(a[1]=g=>n.username=g),placeholder:"用户名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(T,{span:6},{default:l(()=>[e(f,{label:"密码"},{default:l(()=>[e(k,{modelValue:n.password,"onUpdate:modelValue":a[2]||(a[2]=g=>n.password=g),type:"password",placeholder:"密码","show-password":"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(j,{gutter:16},{default:l(()=>[e(T,{span:8},{default:l(()=>[e(f,{label:"分辨率"},{default:l(()=>[e(u,{modelValue:n.resolution,"onUpdate:modelValue":a[3]||(a[3]=g=>n.resolution=g),placeholder:"选择分辨率"},{default:l(()=>[e(U,{label:"1920x1080",value:"1920x1080"}),e(U,{label:"1280x720",value:"1280x720"}),e(U,{label:"854x480",value:"854x480"}),e(U,{label:"640x360",value:"640x360"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(T,{span:8},{default:l(()=>[e(f,{label:"帧率"},{default:l(()=>[e(u,{modelValue:n.fps,"onUpdate:modelValue":a[4]||(a[4]=g=>n.fps=g),placeholder:"选择帧率"},{default:l(()=>[e(U,{label:"30 FPS",value:30}),e(U,{label:"25 FPS",value:25}),e(U,{label:"15 FPS",value:15}),e(U,{label:"10 FPS",value:10})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(T,{span:8},{default:l(()=>[e(f,{label:"质量"},{default:l(()=>[e(J,{modelValue:n.quality,"onUpdate:modelValue":a[5]||(a[5]=g=>n.quality=g),min:1,max:10,step:1,"show-stops":"","show-tooltip":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])),s("div",{class:re(["video-container",{fullscreen:C.value}])},[b.value?(V(),F("div",Ee,[s("video",{ref_key:"videoElement",ref:m,src:d.value,autoplay:"",muted:"",playsinline:"",class:"video-stream",onLoadstart:$,onLoadeddata:Y,onError:D,onPlay:O,onPause:Z},null,40,Re),b.value?(V(),F("div",Ie,[s("div",Me,[s("div",Be,[s("span",qe,[e(v,null,{default:l(()=>[e(p(ve))]),_:1}),_(" "+h(z(R.value)),1)]),s("span",Ne,[e(v,null,{default:l(()=>[e(p(fe))]),_:1}),_(" "+h(S.value),1)]),n.resolution?(V(),F("span",Oe,[e(v,null,{default:l(()=>[e(p(ge))]),_:1}),_(" "+h(n.resolution),1)])):W("",!0)])]),s("div",je,[e(w,{circle:"",size:"small",onClick:K,icon:L.value?p(ye):p(we)},null,8,["icon"]),e(w,{circle:"",size:"small",onClick:Q,icon:p(be)},null,8,["icon"]),e(w,{circle:"",size:"small",onClick:X,type:P.value?"danger":"default",icon:P.value?p(te):p(le)},null,8,["type","icon"])])])):W("",!0)])):(V(),F("div",Le,[e(v,{class:"placeholder-icon"},{default:l(()=>[e(p(G))]),_:1}),a[13]||(a[13]=s("p",null,'点击"开始直播"连接摄像头',-1)),a[14]||(a[14]=s("p",{class:"placeholder-desc"},"支持 RTSP、HTTP、WebRTC 等协议",-1))]))],2),e(de,{modelValue:E.value,"onUpdate:modelValue":a[7]||(a[7]=g=>E.value=g),title:"截图预览",width:"800px",onClose:a[8]||(a[8]=g=>E.value=!1)},{footer:l(()=>[e(w,{onClick:a[6]||(a[6]=g=>E.value=!1)},{default:l(()=>[...a[15]||(a[15]=[_("关闭",-1)])]),_:1}),e(w,{type:"primary",onClick:N},{default:l(()=>[...a[16]||(a[16]=[_("下载截图",-1)])]),_:1})]),default:l(()=>[s("div",Je,[s("img",{src:I.value,alt:"截图预览",class:"screenshot-image"},null,8,We)])]),_:1},8,["modelValue"])]),_:1})])}}},Ae=se(He,[["__scopeId","data-v-33ced6cf"]]);const Ke={class:"camera-live-page"},Qe={class:"header-content"},Xe={class:"header-left"},Ye={class:"header-right"},Ze={class:"card-header"},Ge={class:"camera-list"},el=["onClick"],ll={class:"camera-info"},tl={class:"camera-name"},al={class:"camera-url"},sl={class:"camera-status"},ol={class:"camera-actions"},nl={key:0,class:"empty-camera-list"},rl={class:"stats-content"},ul={class:"stat-item"},il={class:"stat-value"},dl={class:"stat-item"},cl={class:"stat-value"},ml={class:"stat-item"},pl={class:"stat-value"},_l={class:"stat-item"},vl={class:"stat-value"},fl={__name:"CameraLive",setup(ue){const m=Se(),b=c(null),x=c(!1),C=c(null),L=c(),P=c(null),R=c(0),S=c(!1),E=c(""),I=c(""),n=c([{id:1,name:"机场主摄像头",url:"rtsp://192.168.1.100:554/stream1",username:"admin",password:"admin123",resolution:"1920x1080",fps:25,status:"offline",description:"机场主要监控摄像头"},{id:2,name:"跑道摄像头",url:"rtsp://192.168.1.101:554/stream1",username:"admin",password:"admin123",resolution:"1280x720",fps:30,status:"offline",description:"跑道监控摄像头"},{id:3,name:"塔台摄像头",url:"rtsp://192.168.1.102:554/stream1",username:"admin",password:"admin123",resolution:"1920x1080",fps:25,status:"offline",description:"塔台监控摄像头"}]),d=oe({name:"",url:"",username:"",password:"",resolution:"1280x720",fps:25,description:""}),M={name:[{required:!0,message:"请输入摄像头名称",trigger:"blur"}],url:[{required:!0,message:"请输入摄像头地址",trigger:"blur"},{pattern:/^(rtsp|http|https):\/\/.+/,message:"请输入有效的摄像头地址",trigger:"blur"}],resolution:[{required:!0,message:"请选择分辨率",trigger:"change"}],fps:[{required:!0,message:"请选择帧率",trigger:"change"}]},H=()=>{m.push("/")},q=o=>{P.value=o.id,b.value&&Object.assign(b.value.cameraConfig,{url:o.url,username:o.username,password:o.password,resolution:o.resolution,fps:o.fps}),y.success(`已切换到摄像头: ${o.name}`)},A=o=>{C.value=o,Object.assign(d,{name:o.name,url:o.url,username:o.username,password:o.password,resolution:o.resolution,fps:o.fps,description:o.description}),x.value=!0},K=async o=>{try{await Ue.confirm(`确定要删除摄像头 "${o.name}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t=n.value.findIndex(z=>z.id===o.id);t>-1&&(n.value.splice(t,1),y.success("摄像头删除成功"))}catch(t){t!=="cancel"&&y.error("删除摄像头失败")}},Q=async()=>{try{if(await L.value.validate(),C.value){const o=n.value.findIndex(t=>t.id===C.value.id);o>-1&&(n.value[o]={...n.value[o],...d}),y.success("摄像头更新成功")}else{const o={id:Date.now(),...d,status:"offline"};n.value.push(o),y.success("摄像头添加成功")}x.value=!1,N()}catch(o){o.message?y.error(`操作失败: ${o.message}`):console.error("表单验证失败:",o)}},N=()=>{C.value=null,Object.assign(d,{name:"",url:"",username:"",password:"",resolution:"1280x720",fps:25,description:""}),L.value&&L.value.resetFields()},X=o=>{const t=Math.floor(o/3600),z=Math.floor(o%3600/60),$=o%60;return t>0?`${t.toString().padStart(2,"0")}:${z.toString().padStart(2,"0")}:${$.toString().padStart(2,"0")}`:`${z.toString().padStart(2,"0")}:${$.toString().padStart(2,"0")}`};return ne(()=>{const o=localStorage.getItem("camera-list");if(o)try{n.value=JSON.parse(o)}catch(t){console.error("加载摄像头列表失败:",t)}n.value.length>0&&(P.value=n.value[0].id,q(n.value[0])),localStorage.setItem("camera-list",JSON.stringify(n.value))}),(o,t)=>{const z=i("el-icon"),$=i("el-button"),Y=i("el-header"),D=i("el-col"),O=i("el-tag"),Z=i("el-empty"),r=i("el-card"),a=i("el-row"),v=i("el-main"),B=i("el-container"),w=i("el-input"),k=i("el-form-item"),f=i("el-option"),T=i("el-select"),j=i("el-form"),U=i("el-dialog");return V(),F("div",Ke,[e(B,{class:"page-container"},{default:l(()=>[e(Y,{class:"page-header"},{default:l(()=>[s("div",Qe,[s("div",Xe,[e(z,{class:"header-icon"},{default:l(()=>[e(p(G))]),_:1}),t[10]||(t[10]=s("h1",null,"机场直播摄像头",-1))]),s("div",Ye,[e($,{type:"primary",onClick:H,icon:p(Ve)},{default:l(()=>[...t[11]||(t[11]=[_(" 返回面板 ",-1)])]),_:1},8,["icon"])])])]),_:1}),e(v,{class:"page-main"},{default:l(()=>[e(a,{gutter:16},{default:l(()=>[e(D,{span:24,lg:16},{default:l(()=>[e(Ae,{ref_key:"cameraStreamRef",ref:b},null,512)]),_:1}),e(D,{span:24,lg:8},{default:l(()=>[e(r,{shadow:"hover",class:"camera-list-card"},{header:l(()=>[s("div",Ze,[t[13]||(t[13]=s("span",null,"摄像头列表",-1)),e($,{type:"primary",size:"small",onClick:t[0]||(t[0]=u=>x.value=!0),icon:p(he)},{default:l(()=>[...t[12]||(t[12]=[_(" 添加摄像头 ",-1)])]),_:1},8,["icon"])])]),default:l(()=>[s("div",Ge,[(V(!0),F(xe,null,Ce(n.value,u=>(V(),F("div",{key:u.id,class:re(["camera-item",{active:P.value===u.id}]),onClick:J=>q(u)},[s("div",ll,[s("div",tl,h(u.name),1),s("div",al,h(u.url),1),s("div",sl,[e(O,{type:u.status==="online"?"success":"info",size:"small"},{default:l(()=>[_(h(u.status==="online"?"在线":"离线"),1)]),_:2},1032,["type"])])]),s("div",ol,[e($,{type:"text",size:"small",onClick:ae(J=>A(u),["stop"]),icon:p($e)},{default:l(()=>[...t[14]||(t[14]=[_(" 编辑 ",-1)])]),_:1},8,["onClick","icon"]),e($,{type:"text",size:"small",onClick:ae(J=>K(u),["stop"]),icon:p(ke),class:"delete-btn"},{default:l(()=>[...t[15]||(t[15]=[_(" 删除 ",-1)])]),_:1},8,["onClick","icon"])])],10,el))),128)),n.value.length===0?(V(),F("div",nl,[e(Z,{description:"暂无摄像头，请添加摄像头"})])):W("",!0)])]),_:1}),e(r,{shadow:"hover",class:"stats-card"},{header:l(()=>[...t[16]||(t[16]=[s("span",null,"直播统计",-1)])]),default:l(()=>[s("div",rl,[s("div",ul,[t[17]||(t[17]=s("div",{class:"stat-label"},"直播时长",-1)),s("div",il,h(X(R.value)),1)]),s("div",dl,[t[18]||(t[18]=s("div",{class:"stat-label"},"连接状态",-1)),s("div",cl,[e(O,{type:S.value?"success":"info",size:"small"},{default:l(()=>[_(h(S.value?"已连接":"未连接"),1)]),_:1},8,["type"])])]),s("div",ml,[t[19]||(t[19]=s("div",{class:"stat-label"},"当前分辨率",-1)),s("div",pl,h(E.value||"未知"),1)]),s("div",_l,[t[20]||(t[20]=s("div",{class:"stat-label"},"帧率",-1)),s("div",vl,h(I.value||"未知")+" FPS",1)])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(U,{modelValue:x.value,"onUpdate:modelValue":t[9]||(t[9]=u=>x.value=u),title:C.value?`编辑摄像头 - ${C.value.name}`:"添加摄像头",width:"600px",onClose:N},{footer:l(()=>[e($,{onClick:t[8]||(t[8]=u=>x.value=!1)},{default:l(()=>[...t[21]||(t[21]=[_("取消",-1)])]),_:1}),e($,{type:"primary",onClick:Q},{default:l(()=>[_(h(C.value?"更新":"添加"),1)]),_:1})]),default:l(()=>[e(j,{model:d,rules:M,ref_key:"cameraFormRef",ref:L,"label-width":"100px"},{default:l(()=>[e(k,{label:"摄像头名称",prop:"name"},{default:l(()=>[e(w,{modelValue:d.name,"onUpdate:modelValue":t[1]||(t[1]=u=>d.name=u),placeholder:"请输入摄像头名称"},null,8,["modelValue"])]),_:1}),e(k,{label:"摄像头地址",prop:"url"},{default:l(()=>[e(w,{modelValue:d.url,"onUpdate:modelValue":t[2]||(t[2]=u=>d.url=u),placeholder:"rtsp://ip:port/stream"},null,8,["modelValue"])]),_:1}),e(a,{gutter:16},{default:l(()=>[e(D,{span:12},{default:l(()=>[e(k,{label:"用户名"},{default:l(()=>[e(w,{modelValue:d.username,"onUpdate:modelValue":t[3]||(t[3]=u=>d.username=u),placeholder:"用户名"},null,8,["modelValue"])]),_:1})]),_:1}),e(D,{span:12},{default:l(()=>[e(k,{label:"密码"},{default:l(()=>[e(w,{modelValue:d.password,"onUpdate:modelValue":t[4]||(t[4]=u=>d.password=u),type:"password",placeholder:"密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(a,{gutter:16},{default:l(()=>[e(D,{span:12},{default:l(()=>[e(k,{label:"分辨率"},{default:l(()=>[e(T,{modelValue:d.resolution,"onUpdate:modelValue":t[5]||(t[5]=u=>d.resolution=u),placeholder:"选择分辨率"},{default:l(()=>[e(f,{label:"1920x1080",value:"1920x1080"}),e(f,{label:"1280x720",value:"1280x720"}),e(f,{label:"854x480",value:"854x480"}),e(f,{label:"640x360",value:"640x360"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(D,{span:12},{default:l(()=>[e(k,{label:"帧率"},{default:l(()=>[e(T,{modelValue:d.fps,"onUpdate:modelValue":t[6]||(t[6]=u=>d.fps=u),placeholder:"选择帧率"},{default:l(()=>[e(f,{label:"30 FPS",value:30}),e(f,{label:"25 FPS",value:25}),e(f,{label:"15 FPS",value:15}),e(f,{label:"10 FPS",value:10})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(k,{label:"描述"},{default:l(()=>[e(w,{modelValue:d.description,"onUpdate:modelValue":t[7]||(t[7]=u=>d.description=u),type:"textarea",rows:3,placeholder:"摄像头描述（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},yl=se(fl,[["__scopeId","data-v-33e17e7e"]]);export{yl as default};
